# docker-compose.yml
# (no `version:` header—Compose v2 infers spec automatically)

services:
  bench:
    build:
      context: ./bench-app
      dockerfile: Dockerfile
    env_file:
      - .env
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: "no"
    # ─── bind your model via Compose Models ───
    models:
      my_model:
        endpoint_var: LLM_URL    # Injects the model endpoint URL here
        model_var:    LLM_MODEL  # Injects the model identifier here
    command: ["python", "load_test.py"]

models:
  my_model:
    model: ${LLM_MODEL_NAME}    # Pulled from .env
    context_size: 4096
    runtime_flags:
      - "--parallel 2"
      - "--no-prefill-assistant"

networks:
  default:
    name: dmr-compose-bench-net
    driver: bridge
